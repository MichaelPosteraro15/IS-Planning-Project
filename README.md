# Snowman Planner

Welcome to the **Snowman Planner**, a Python-based project designed to simulate and visualize a snowman-building scenario using Planning Domain Definition Language (PDDL). This project includes tools to parse PDDL domain and problem files, simulate plans, extract metrics, and create an animated visualization of a character moving and stacking snowballs to build a snowman.

## Project Overview

The Snowman Planner tackles a planning problem where a character navigates a grid to move and stack snowballs of varying sizes (small, medium, large) to achieve a goal state, typically stacking three balls in one location. The project supports two domain variants:
- **Classic Domain**: Uses predicates to represent ball sizes and location types.
- **Numeric Domain**: Uses numeric functions for ball sizes and location types, allowing for more compact representations.

Key features include:
- Parsing PDDL problem and plan files to extract initial states and actions.
- Simulating plans to track character movements, ball movements, and ball size growth when rolled over snow.
- Generating a CSV summary of plan metrics (e.g., plan length, cost, node expansions).
- Visualizing the plan execution with an animated grid-based simulation using Matplotlib.

## Repository Structure

```
snowman-planner/
│
├── comparasion.py         # Script to parse plans and generate a CSV summary of metrics
├── domain-classic.pddl    # PDDL domain file for the classic predicate-based model
├── domain-numeric.pddl    # PDDL domain file for the numeric function-based model
├── problem-classic.pddl   # PDDL problem file for the classic domain
├── problem-numeric.pddl   # PDDL problem file for the numeric domain
├── plan_numeric.txt       # Sample plan output for the numeric domain
├── plan_classic.txt       # Sample plan output for the numeric domain
├── visualizer.py          # Script to animate the plan execution
├── comparison_metrics.csv # Output CSV file with plan metrics (generated by comparasion.py)
└── README.md              # This file
```

## Prerequisites

To run the project, ensure you have the following installed:

- **Python 3.8+**
- **Required Python packages**:
  ```bash
  pip install matplotlib
  ```
- A PDDL planner (e.g., Fast Downward) to generate plan files (optional, as a sample plan is included).

## Installation

1. Clone the repository:
   ```bash
   git clone https://github.com/your-username/snowman-planner.git
   cd snowman-planner
   ```

2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```
   *Note*: If you don't have a `requirements.txt`, simply run `pip install matplotlib`.

3. Ensure the provided PDDL files (`domain-*.pddl`, `problem-*.pddl`) and the plan file (`plan_numeric.txt`) are in the project directory.

## Usage

### 1. Generating Plan Metrics

The `comparasion.py` script processes plan files (e.g., `plan_numeric.txt`) and corresponding problem files to extract metrics and simulate the plan execution. It outputs a CSV file (`comparison_metrics.csv`) with metrics like plan length, cost, node expansions, and action counts.

To run:
```bash
python comparasion.py
```

**Output**:
- A file named `comparison_metrics.csv` (or `out_snowman.csv` in the user's home directory if permission issues occur) containing metrics for each plan file.
- Console messages indicating the processing status and any errors.

**Example Output (`comparison_metrics.csv`)**:
```csv
run_name,ground_time_ms,f_count,x_count,...,move_character_count,move_ball_count,goal_count,ball_growth_count,final_ball_location,final_ball_sizes,computed_cost
plan_numeric,187,85,24,...,76,15,1,3,loc_1_3,ball_0:1,ball_1:1,ball_2:1,91
```

**Troubleshooting**:
If you encounter permission errors, the script attempts to write to a fallback location (`~/out_snowman.csv`). Follow the printed troubleshooting steps if issues persist.

### 2. Visualizing the Plan

The `visualizer.py` script creates an animated visualization of the plan execution using Matplotlib. It shows:
- A grid where snow-covered cells are light cyan, and empty cells are light green.
- Snowballs as white circles with sizes reflecting their growth (small, medium, large).
- The character as a black circle with a rectangular body.
- Step descriptions displayed above the grid.

To run:
```bash
python visualizer.py
```

**Features**:
- **Animation**: Interpolates movements over 10 substeps for smooth transitions.
- **Play/Pause Button**: Toggle the animation with a button at the bottom of the window.
- **Step Descriptions**: Printed in the console and displayed on the plot for each action.

**Requirements**:
- Ensure `problem-numeric.pddl` and `plan_numeric.txt` are in the project directory.
- The visualization assumes the numeric domain by default but can be adapted for the classic domain by modifying the `PROBLEM_FILE` constant in `visualizer.py`.

## How It Works

1. **PDDL Files**:
   - **Domain Files** (`domain-classic.pddl`, `domain-numeric.pddl`): Define the snowman-building domain with actions (`move_character`, `move_ball`, `goal`) and constraints (e.g., balls can only stack if smaller on top).
   - **Problem Files** (`problem-classic.pddl`, `problem-numeric.pddl`): Define the initial state (e.g., character position, ball positions, snow locations) and the goal (stacking three balls in one location).
   - **Plan File** (`plan_numeric.txt`): Contains the sequence of actions generated by a PDDL planner.

2. **Comparasion Script**:
   - Parses plan and problem files to extract metrics using regex patterns.
   - Simulates the plan to count actions, track ball growth, and Viernes, 02 de julio de 2025 a las 15:52, hora de verano del Pacíficoball locations, and compute costs.
   - Outputs results to a CSV file.

3. **Visualizer Script**:
   - Parses the problem and plan to create a list of animation frames.
   - Animates the character's and balls' movements on a grid, showing snow removal and ball size growth.
   - Uses Matplotlib for rendering and includes a play/pause button.

## Customization

- **Change Plan File**: Modify the `PLAN_FILE` constant in `visualizer.py` to visualize a different plan.
- **Adjust Animation Speed**: Change `SUBSTEPS` or `PLT_PAUSE` in `visualizer.py` to control animation smoothness and pause duration.
- **Grid Appearance**: Modify colors or `RADIUS` values in `visualizer.py` to customize the visualization.

## Limitations

- The visualizer is tailored for the numeric domain. To use the classic domain, update the parsing logic in `visualizer.py` to handle predicate-based ball sizes and location types.
- The project assumes plan files follow the format of `plan_numeric.txt`. Custom planners may require adjustments to the parsing logic.
- Large grids or long plans may slow down the visualization due to the number of frames.

## Contributing

Contributions are welcome! Please submit a pull request or open an issue on GitHub for bug reports, feature requests, or improvements.

## License

This project is licensed under the Unical A Masters of AI and CS students 2025/2026 License. 
## Acknowledgments

- Built with Python, Matplotlib, and inspiration from PDDL planning challenges.
- Thanks to the open-source community for tools like Fast Downward.

For questions or support, contact [your-email@example.com] or open an issue on GitHub.